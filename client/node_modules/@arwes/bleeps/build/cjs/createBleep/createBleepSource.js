"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createBleepSource = void 0;
const createBleepSource = (props) => {
    const { context, buffer, gain, loop, onStop } = props;
    const source = context.createBufferSource();
    let started = false;
    let stopped = false;
    source.buffer = buffer;
    source.loop = !!loop;
    if (loop) {
        source.loopStart = 0;
        source.loopEnd = buffer.duration;
    }
    const start = () => {
        if (!started) {
            source.start();
            started = true;
        }
    };
    const stop = () => {
        if (!stopped) {
            source.stop();
            source.disconnect(gain);
            stopped = true;
            onStop?.();
        }
    };
    source.connect(gain);
    source.onended = () => {
        if (!stopped) {
            onStop?.();
        }
    };
    return {
        get started() {
            return started;
        },
        get stopped() {
            return stopped;
        },
        start,
        stop
    };
};
exports.createBleepSource = createBleepSource;
